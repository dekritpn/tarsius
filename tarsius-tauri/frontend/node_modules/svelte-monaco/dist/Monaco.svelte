<script context="module">export const exportedThemes = Object.fromEntries(
  Object.entries(import.meta.glob("/node_modules/monaco-themes/themes/*.json")).map(([k, v]) => [
    k.toLowerCase().split("/").reverse()[0].slice(0, -".json".length).replaceAll(" ", "-"),
    v
  ])
);
export const nativeThemes = ["vs", "vs-dark", "hc-black"];
export const themeNames = [...Object.keys(exportedThemes), ...nativeThemes].sort(
  (a, b) => a.localeCompare(b)
);
</script>

<script>import { onDestroy, onMount } from "svelte";
import { createEventDispatcher } from "svelte";
import loader from "@monaco-editor/loader";
let monaco;
const dispatch = createEventDispatcher();
let container;
export let editor = void 0;
export let value;
export let theme = void 0;
export let options = {
  value,
  automaticLayout: true
};
function refreshTheme() {
  if (theme) {
    if (exportedThemes[theme]) {
      const themeName = theme;
      exportedThemes[theme]().then((resolvedTheme) => {
        monaco?.editor.defineTheme(themeName, resolvedTheme);
        monaco?.editor.setTheme(themeName);
      });
    } else if (nativeThemes.includes(theme)) {
      monaco?.editor.setTheme(theme);
    }
  }
}
$:
  if (theme)
    refreshTheme();
$:
  editor?.updateOptions(options);
$:
  model = editor?.getModel();
$:
  model && options.language ? monaco.editor.setModelLanguage(model, options.language) : void 0;
$:
  if (editor && editor.getValue() != value) {
    const position = editor.getPosition();
    editor.setValue(value);
    if (position)
      editor.setPosition(position);
  }
onMount(async () => {
  monaco = await loader.init();
  editor = monaco.editor.create(container, options);
  dispatch("ready", editor);
  refreshTheme();
  editor.getModel().onDidChangeContent(() => {
    if (!editor)
      return;
    value = editor.getValue();
  });
});
onDestroy(() => editor?.dispose());
</script>

<div class="monaco-container" bind:this={container} />

<style>
	div.monaco-container {
		width: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
	}
</style>
